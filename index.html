<!DOCTYPE html>
<html lang="he">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>הרשמה - משפחה</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <div class="container auth-container">
    <h1>הרשמה</h1>
    <form id="registerForm">
      <label for="username">שם משתמש:</label>
      <input type="text" id="username" required />

      <label for="password">סיסמה:</label>
      <input type="password" id="password" required />

      <label for="role">בחר סוג משתמש:</label>
      <select id="role" required>
        <option value="child">ילד 👦</option>
        <option value="guest">אורח 👤</option>
        <option value="admin">מנהל 🧑‍💼</option>
      </select>

      <div id="adminCodeContainer" style="display:none;">
        <label for="adminCode">קוד סודי למנהל:</label>
        <input type="password" id="adminCode" placeholder="הכנס קוד סודי" />
      </div>

      <button type="submit">הרשם</button>
    </form>

    <p>כבר רשום? <a href="login.html">התחבר כאן</a></p>
    <div id="message" class="message"></div>
  </div>

  <script src="auth.js"></script>

  <!-- ✅ הוספה: חיבור ל-Firebase ושמירה בענן -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
    import { getFirestore, collection, addDoc } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";
// Import the functions you need from the SDKs you need
import { initializeApp } from "firebase/app";
import { getAnalytics } from "firebase/analytics";
// TODO: Add SDKs for Firebase products that you want to use
// https://firebase.google.com/docs/web/setup#available-libraries

// Your web app's Firebase configuration
// For Firebase JS SDK v7.20.0 and later, measurementId is optional
const firebaseConfig = {
  apiKey: "AIzaSyDx7yFK3BkGx4zD_NWSO0Q8bYdJthIrK8k",
  authDomain: "family-2800b.firebaseapp.com",
  projectId: "family-2800b",
  storageBucket: "family-2800b.firebasestorage.app",
  messagingSenderId: "709405996945",
  appId: "1:709405996945:web:5f9513c58fd5445c578c30",
  measurementId: "G-SHRHHQQ10K"
};

// Initialize Firebase
const app = initializeApp(firebaseConfig);
const analytics = getAnalytics(app);

   

    // 🧾 שמירה של משתמש חדש ב-Firestore
    const form = document.getElementById("registerForm");
    const messageBox = document.getElementById("message");

    form.addEventListener("submit", async (e) => {
      e.preventDefault();

      const username = document.getElementById("username").value.trim();
      const password = document.getElementById("password").value.trim();
      const role = document.getElementById("role").value;
      const adminCode = document.getElementById("adminCode").value.trim();

      if (role === "admin" && adminCode !== "1234") {
        messageBox.textContent = "❌ קוד מנהל שגוי!";
        messageBox.style.color = "red";
        return;
      }

      try {
        await addDoc(collection(db, "users"), {
          username,
          password,
          role,
          createdAt: new Date()
        });

        messageBox.textContent = "✅ נרשמת בהצלחה!";
        messageBox.style.color = "green";
        form.reset();
      } catch (err) {
        console.error(err);
        messageBox.textContent = "שגיאה בשמירה לשרת!";
        messageBox.style.color = "red";
      }
    });
  </script>
</body>
</html>

